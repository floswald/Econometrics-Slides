<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>ScPoEconometrics</title>
    <meta charset="utf-8" />
    <meta name="author" content="Florian Oswald" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="..\css\scpo.css" type="text/css" />
    <link rel="stylesheet" href="..\css\scpo-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# ScPoEconometrics
## Intro To Causality
<<<<<<< HEAD
### Florian Oswald, Gustave Kenedi and Pierre Villedieu
### SciencesPo Paris </br> 2020-03-10

||||||| merged common ancestors
### Florian Oswald, Gustave Kenedi and Pierre Villedieu
### SciencesPo Paris </br> 2020-03-03
=======
### Florian Oswald
### SciencesPo Paris </br> 2019-11-18
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

---


layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/ScPo-shield.png" style="height: 60px;"/&gt;&lt;/div&gt; 

---



layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/ScPo-shield.png" style="height: 60px;"/&gt;&lt;/div&gt; 

---

# Packages used in this set of slides


```r
library(tidyverse)
```

---

# Why Causality?

- Many of the interesting questions we might want to answer with data are causal&lt;sup&gt;1&lt;/sup&gt;

- Some are non-causal, too - for example, "how can we predict whether this photo is of a dog or a cat" is vital to how Google Images works, but it doesn't care what *caused* the photo to be of a dog or a cat

- Nearly every *why* question is causal

- *Why* is a first order question for any policy maker thinking about a new policy.

.footnote[
[1]: This set of slides follows closely the great material by [Nick Huntington Klein](https://nickch-k.github.io/introcausality/)
]

---

# Also

- This is economists' comparative advantage!

- Plenty of fields do statistics. But very few make it standard training for their students to understand causality

- This understanding of causality makes economists very useful! *This* is one big reason why tech companies have whole economics departments in them

---

# So what is causality?

- We say that `X` *causes* `Y` if...

- were we to intervene and *change* the value of `X` without changing anything else...

- then `Y` would also change as a result

---

# Some examples of causal relationships

.pull-left[
## Some Obvious:

- A light switch being set to on causes the light to be on

- Setting off fireworks raises the noise level

]

--

.pull-right[

## Some less obvious:

- Getting a college degree increases your earnings

- Tariffs reduce the amount of trade

]

---

# Correlation vs Causation

* That's becomes almost a trueism: *Correlation is not equal Causation*.

* Well, we're here to figure out conditions when it **is**!

## Examples of non-zero *correlations* that are not *causal* (or may be causal in the wrong direction!)

.pull-left[

### Some obvious:

- People tend to wear shorts on days when ice cream trucks are out

- Rooster crowing sounds are followed closely by sunrise

] 

.pull-right[

### Some less obvious:

- Colds tend to clear up a few days after you take Emergen-C

- The performance of the economy tends to be lower or higher depending on the president's political party

]

---

# [Spurious](https://www.tylervigen.com/spurious-correlations) Correlation?

![](../img/photos/spurious.png)

---

# Good and Bad Correlation?

* *Correlation* is a well-defined concept of statistical **association**

* It's clearly true that space launches and Sociology doctorates have a correlation coefficient of 78%.

* However, what relationship lies **behind** this association is a more difficult question. 

* In other words, what does it **mean** to measure a correlation between two variables?

---


# Important Note

- "X causes Y" *doesn't* mean that X is necessarily the *only* thing that causes Y

- And it *doesn't* mean that all Y must be X

- For example, using a light switch causes the light to go on

- But not if the bulb is burned out (no Y, despite X), or if the light was already on (Y without X)

- But still we'd say that using the switch causes the light! The important thing is that X *changes the probability* that Y happens, not that it necessarily makes it happen for certain


---

# So How Can We Tell?

- As just shown, there are plenty of *correlations* that aren't *causal*

- So if we have a correlation, how can we tell if it *is*?

- For this we're going to have to think hard about *causal inference*. That is, inferring causality from data.

---
layout: false
class: title-slide-section-red, middle

# Causal Inference



---
layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/ScPo-shield.png" style="height: 60px;"/&gt;&lt;/div&gt; 

---

# The Problem of Causal Inference

.pull-left[
- Let's try to think about whether some `X` causes `Y`

- That is, if we manipulated `X`, then `Y` would change as a result

- For simplicity, let's assume that `X` is either 1 or 0, like "got a medical treatment" or "didn't"

]

--

.pull-right[

## The Problem of Causal Inference

- Now, how can we know *what would happen* if we manipulated `X`?

- Let's consider just one person - Angela. We could just check what Angela's `Y` is when we make `X=0`, and then check what Angela's `Y` is again when we make `X=1`.

- Are those two `Y`s different? If so, `X` causes `Y`!

- Do that same process for everyone in your sample and you know in general what the effect of `X` on `Y` is.

]

---

# The Problem of Causal Inference


- You may have spotted the problem!

- Just like you can't be in two places at once, Angela can't exist both with `X=0` and with `X=1`. She either got that medical treatment or she didn't.

- Let's say she did. So for Angela, `X=1` and, let's say, her outcome is `Y=10`.

- The other one, what `Y` *would have been* if we made `X=0`, is **missing**. 

- We don't know what it is! Could also be `Y=10`. Could be `Y=9`. Could be `Y=1000`!


---


# The Problem of Causal Inference

- Well, why don't we just take someone who actually DOES have `X=0` and compare their `Y`?

- Because there are lots of reasons their `Y` could be different BESIDES `X`.

- They're not Angela! A character flaw to be sure. ðŸ˜€

- So if we find someone, Gareth, with `X=0` and they have `Y=9`, is that because `X` increases `Y`, or is that just because Angela and Gareth would have had different `Y`s anyway?

- ðŸ¤”

---


# The Problem of Causal Inference

- The main goal we have in doing causal inference is in making *as good a guess as possible* as to what that `Y` *would have been* if `X` had been different.

- That "would have been" is called a *counterfactual* - counter to the fact of what actually happened.

- In doing so, we want to think about two people/firms/countries that are basically *exactly the same* except that one has `X=0` and one has `X=1`.

- If we could, we'd pick someone *identical* to Angela, the only difference being that they had `X=0` and not `X=1`.





---
layout: false
class: title-slide-section-red, middle

# Experiments



---
layout: true

&lt;div class="my-footer"&gt;&lt;img src="../img/logo/ScPo-shield.png" style="height: 60px;"/&gt;&lt;/div&gt; 

---

# Experiments

.pull-left[
- A common way to do this in many fields is an *experiment*.

- If you can *randomly assign* `X`, then you know that the people with `X=0` are, on average, exactly the same as the people with `X=1`.

<<<<<<< HEAD
Last week we regressed average student math and reading scores on class size.
||||||| merged common ancestors
Last week we regressed class size on average student math and reading scores.
=======
- So that's an easy comparison!
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

]

--

.pull-right[


- When we're working with people/firms/countries, running experiments is often infeasible, impossible, or unethical.

- So we have to think hard about a *model* of what the world looks like.

- So that we can use our model to figure out what the *counterfactual* would be.

]


---

# Models

- In causal inference, the *model* is our idea of what we think the process is that *generated the data*.

- We have to make some assumptions about what this is!

- We put together what we know about the world with assumptions and end up with our model.

- The model can then tell us what kinds of things could give us wrong results so we can fix them and get the right counterfactual.

---

# Models

- Wouldn't it be nice to not have to make assumptions?

- Yeah, but it's impossible to skip!

<<<<<<< HEAD
1. What's the unit of observation? Which variable contains: (i) the (random) class assignment, (ii) the student's class grade, (iii) the outcomes of interest?

1. How many observations are there? Why so many?

1. Why are there so many `NA`s? What do they correspond to?

1. Keep only cases with no `NA`s with the following code:  
`star_df &lt;- star_df[complete.cases(star_df),]`

1. Let's check how well the randomization was done by doing ***balancing checks***.  
Compute the average percentage of girls, african americans, and free lunch qualifiers by grade *and* treatment class.  
*Hint*: The following computes the percentage of girls (without the relevant `dplyr` verbs)
`share_female = mean(gender == "female") * 100`.
||||||| merged common ancestors
1. What's the unit of observation? Which variable contains: (i) the (random) class assignment, (ii) the student's class grade, (iii) the outcomes of interest?

1. How many observations are there? Why so many?

1. Why are there so many `NA`s? What do they correspond to?

1. Keep only cases with no `NA`s with the following code:  
`star_df &lt;- star_df[complete.cases(star_long),]`

1. Let's check how well the randomization was done by doing ***balancing checks***.  
Compute the average percentage of girls, african americans, and free lunch qualifiers by grade *and* treatment class.  
*Hint*: The following computes the percentage of girls (without the relevant `dplyr` verbs)
`share_female = mean(gender == "female") * 100`.
=======
- We're trying to predict something that hasn't happened - a counterfactual.
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

- This is literally impossible to do if you don't have some model of how the data is generated.

- You can't even predict the sun will rise tomorrow without a model!

- If you think you can, you're just don't realize the model you're using - that's dangerous!

---

# An Example: Randomization

- Let's generate some data.
- Let's say that getting `X` causes `Y` to increase by 100.
- And let's run a randomized experiment of who actually gets X and estimate the size of the effect (should be close to `100`!)

.pull-left[

```r
true_effect &lt;- 100
df &lt;- tibble(Y.without.X = rnorm(1000),
             X=sample(c(0,1),1000,replace=T)) %&gt;%
  mutate(Y.with.X = Y.without.X + true_effect) %&gt;%
  #Now assign who actually gets X
  mutate(Observed.Y = ifelse(X==1,Y.with.X,Y.without.X))
head(df,4)
```

```
## # A tibble: 4 x 4
##   Y.without.X     X Y.with.X Observed.Y
##         &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1      0.930      0    101.      0.930 
## 2     -0.0645     0     99.9    -0.0645
## 3     -0.461      1     99.5    99.5   
## 4      0.594      1    101.    101.
```
]

.pull-right[
* Now, estimate the group means and simply difference them:

```r
#And see what effect our experiment suggests X has on Y
df %&gt;% group_by(X) %&gt;% 
  summarize(Y = mean(Observed.Y)) %&gt;%
  pull(Y) %&gt;% diff
```

```
## [1] 99.95001
```
]

* That's pretty close to the true effect there!

---

# An Example: No Randomization

- Suppose now we can *not* randomize the `X`.

- Instead there is some kind of rule that decides about `X`.

.pull-left[

```r
df &lt;- tibble(Z = runif(10000)) %&gt;% 
  mutate(Y.without.X = rnorm(10000)+100*Z, 
         Y.with.X = Y.without.X + 100) %&gt;%
  #Now assign who actually gets X
  mutate(X = Z &gt; .9,
         Observed.Y = ifelse(X==1,Y.with.X,Y.without.X))
head(df)
```

```
## # A tibble: 6 x 5
##       Z Y.without.X Y.with.X X     Observed.Y
##   &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;lgl&gt;      &lt;dbl&gt;
## 1 0.263        27.2     127. FALSE       27.2
## 2 0.113        10.7     111. FALSE       10.7
## 3 0.325        32.6     133. FALSE       32.6
## 4 0.186        18.0     118. FALSE       18.0
## 5 0.836        83.5     183. FALSE       83.5
## 6 0.833        82.9     183. FALSE       82.9
```
]

--

.pull-right[


```r
df %&gt;% group_by(X) %&gt;% 
  summarize(Y = mean(Observed.Y)) %&gt;%
  pull(Y) %&gt;% diff
```

```
## [1] 149.3084
```

* That's not the correct effect size!

* But if we properly model the assignment process and compare apples to apples?


```r
df %&gt;% filter(abs(Z-.9)&lt;.01) %&gt;% 
  group_by(X) %&gt;% 
  summarize(Y = mean(Observed.Y)) %&gt;%
  pull(Y) %&gt;% diff
```

```
## [1] 100.9533
```
]

---

# Building the Counterfactual

* In that last example our first attempt failed because we had not taken selection into account.

<<<<<<< HEAD
`\(\begin{align} \mathbb{E}[\textrm{math score} | D_i = 0]&amp;= \mathbb{E}[b_0 + \delta D_i + e_i | D_i = 0] \\ &amp;= b_0 + \delta \mathbb{E}[D_i| D_i = 0] + \mathbb{E}[e_i|D_i = 0] \\ &amp;= b_0 \end{align}\)`
||||||| merged common ancestors
`\(\begin{align} \mathbb{E}[\textrm{math score} | D_i = 0]&amp;= \mathbb{E}[b_0 + \delta D_i + e_i | D_i = 0] \\ &amp;= b_0 + \delta \mathbb{E}[D_i| D_i = 0] \\ &amp;= b_0 \end{align}\)`
=======
* It turns out that `Z` influences `Y.without.X`, which at the same time will be part of our estimator for the true effect size.
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

* But `Z` also determines who gets treatment! All the ones with `Z &gt; 0.9`!

<<<<<<< HEAD
`\(\begin{align} \mathbb{E}[\textrm{math score} | D_i = 1]&amp;= \mathbb{E}[b_0 + \delta D_i + e_i | D_i = 1] \\ &amp;= b_0 + \delta \mathbb{E}[D_i| D_i = 1] + \mathbb{E}[e_i|D_i = 1] \\ &amp;= b_0 + \delta \end{align}\)`
||||||| merged common ancestors
`\(\begin{align} \mathbb{E}[\textrm{math score} | D_i = 1]&amp;= \mathbb{E}[b_0 + \delta D_i + e_i | D_i = 1] \\ &amp;= b_0 + \delta \mathbb{E}[D_i| D_i = 1] \\ &amp;= b_0 + \delta \end{align}\)`
=======
* So, people with `Z &gt; 0.9` get treated, but **also** have a relatively high `Y.without.X`. 
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

* You can see that there is a depenence between the assignment and the effect size.


---

<<<<<<< HEAD
class:inverse

# Task 4 (10 minutes)

1. Filter the dataset to only keep first graders and the small class and regular class groups.

1. Compute the average math score for both groups, and the difference between the two. (Use base `R`.)

1. Create a dummy variable `treatment` equal to `TRUE` if student is in treatment group (i.e. small class size) and `FALSE` if in control group (i.e. regular class size). See slide 33 for how to create a dummy variable.

1. Regress math score on the treatment dummy variable. Are the results in line with the previous question?

1. How do you interpret these coefficients?

---

# Shortcomings of RCTs 

RCTs have very strong ***internal validity***, that is they can convincingly establish causal links.

However, they have some shortcomings:

* RCT are often **infeasible**:

  * RCTs are **costly**,
  * RCTs may face some **ethical issues**: some *treatments* simply cannot be given to people,
  * RCTs take time and we may be **time constrained**.

--

* **Interpretation** of the results:

  * ***External validity***: To what extent can the results from a given RCT be generalized to other contexts (countries, populations,...)?
  
  * Uncovering the mechanisms that are at stake may be difficult,
  
  * Imperfect randomization, attrition, ...

---


# What comes next? 

* So if we cannot rely on RCTs to make our life easy, it means we have to find a way to make causal inference from ***observational data*** (as opposed to ***experimental data***).

--

* It brings us back to models 

  - In causal inference, the *model* is our idea of what the process that *generated the data* is.

  - We have to make some assumptions about what this is!

--

2 broad cases:
||||||| merged common ancestors
class:inverse

# Task 4 (10 minutes)

1. Filter the dataset to only keep first graders and the small class and regular class groups.

1. Compute the average math score for both groups, and the difference between the two. (Use base `R`.)

1. Create a dummy variable `treatment` equal to `TRUE` if student is in treatment group (i.e. small class size) and `FALSE` if in control group (i.e. regular class size). See slide 33 for how to create a dummy variable.

1. Regress the treatment dummy variable on math score. Are the results in line with the previous question?

1. How do you interpret these coefficients?

---

# Shortcomings of RCTs 

RCTs have very strong ***internal validity***, that is they can convincingly establish causal links.

However, they have some shortcomings:

* RCT are often **infeasible**:

  * RCTs are **costly**,
  * RCTs may face some **ethical issues**: some *treatments* simply cannot be given to people,
  * RCTs take time and we may be **time constrained**.

--

* **Interpretation** of the results:

  * ***External validity***: To what extent can the results from a given RCT be generalized to other contexts (countries, populations,...)?
  
  * Uncovering the mechanisms that are at stake may be difficult,
  
  * Imperfect randomization, attrition, ...

---


# What comes next? 

* So if we cannot rely on RCTs to make our life easy, it means we have to find a way to make causal inference from ***observational data*** (as opposed to ***experimental data***).

--

* It brings us back to models 

  - In causal inference, the *model* is our idea of what the process that *generated the data* is.

  - We have to make some assumptions about what this is!

--

2 broad cases:
=======
class: title-slide-final, middle
>>>>>>> 996b8c7cc9eb0bfdd71ffe225c35208855af45d9

# THANKS

To [Nick Huntington Klein](http://www.nickchk.com/index.html) for making his lecture material available online!

---

class: title-slide-final, middle
background-image: url(../img/logo/ScPo-econ.png)
background-size: 250px
background-position: 9% 19%

# END




|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| &lt;a href="mailto:florian.oswald@sciencespo.fr"&gt;.ScPored[&lt;i class="fa fa-paper-plane fa-fw"&gt;&lt;/i&gt;]               | florian.oswald@sciencespo.fr       |
| &lt;a href="https://github.com/ScPoEcon/ScPoEconometrics-Slides"&gt;.ScPored[&lt;i class="fa fa-link fa-fw"&gt;&lt;/i&gt;] | Slides |
| &lt;a href="https://scpoecon.github.io/ScPoEconometrics"&gt;.ScPored[&lt;i class="fa fa-link fa-fw"&gt;&lt;/i&gt;] | Book |
| &lt;a href="http://twitter.com/ScPoEcon"&gt;.ScPored[&lt;i class="fa fa-twitter fa-fw"&gt;&lt;/i&gt;]                          | @ScPoEcon                         |
| &lt;a href="http://github.com/ScPoEcon"&gt;.ScPored[&lt;i class="fa fa-github fa-fw"&gt;&lt;/i&gt;]                          | @ScPoEcon                       |
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../js/ru_xaringan.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
